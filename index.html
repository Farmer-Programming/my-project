<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>çƒŸå°˜é“ç»Ÿè®¡åˆ†æç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å¼•å…¥ Manifest æ–‡ä»¶ -->
    <link rel="manifest" href="manifest.json">
    <!-- è®¾ç½®ä¸»é¢˜é¢œè‰² -->
    <meta name="theme-color" content="#317EFB">
    <!-- ç§»åŠ¨è®¾å¤‡å‹å¥½ -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="style.css">
</head>

<!-- è‡ªæ•‘è„šæœ¬ï¼šç¡®ä¿ç™»å½•åæ˜¾ç¤ºä¸»åº”ç”¨ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7"></script>
<script>
    // åˆå§‹åŒ– Supabase
    const supabase = supabase.createClient(
        'https://gboujpgswtpyftlakvsm.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdib3VqcGdzd3RweWZ0bGFrdnNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyNjU4MjYsImV4cCI6MjA3Mzg0MTgyNn0.JacF3xi3xzqThgBCk7xVlKGVipBPiDCIbVgA5GZB7Zs'
    );

    // æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶æ˜¾ç¤ºä¸»åº”ç”¨
    async function checkAuthAndShowApp() {
        try {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                console.log('âœ… ç”¨æˆ·å·²ç™»å½•ï¼Œæ˜¾ç¤ºä¸»åº”ç”¨');
                document.getElementById('main-app').style.display = 'block';
            } else {
                console.log('âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ');
                window.location.href = 'login.html';
            }
        } catch (error) {
            console.error('âŒ æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
            window.location.href = 'login.html';
        }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(checkAuthAndShowApp, 1000); // å»¶è¿Ÿ1ç§’ï¼Œç¡®ä¿DOMåŠ è½½å®Œæˆ
    });
</script>

<body>
    <!-- å®‰è£…æŒ‰é’® -->
    <button id="installBtn" style="display:none;">ğŸ“² å®‰è£…åº”ç”¨</button>

    <!-- ä¸»åº”ç”¨å®¹å™¨ï¼ˆåˆå§‹éšè—ï¼Œç™»å½•åç”± app-with-cloud.js æ˜¾ç¤ºï¼‰ -->
    <div id="main-app" style="display: none;">
        <div class="chart-container">
            <canvas id="trendChart"></canvas>
        </div>

        <div class="data-grid">
            <input id="input1" type="text" placeholder="æ³¨å…¥æœ¬é‡‘"> 
            <input id="input2" type="text" placeholder="åˆå§‹æ³¨ç "> 
            <input id="input3" type="text" placeholder="æœ€ä½æ³¨ç "> 
            <input id="input4" type="text" placeholder="åŠ å‡å•ä½"> 
            <input id="input5" type="text" placeholder="æœŸæœ›ç›ˆåˆ©">
            <input id="input6" type="text" placeholder="ä¸‹æ³¨æ–¹å‘">
            <input id="input7" type="text" placeholder="ä¸‹æ³¨æ³¨ç "> 
            <input id="input8" type="text" placeholder="åŠ åˆ°1.06%">
            <input id="stat-total-hands" type="text" placeholder="æ€»ä½“æ‰‹æ•°" readonly>
            <input id="stat-win-hands" type="text" placeholder="æ€»ä½“èƒœæ‰‹" readonly> 
            <input id="stat-net-win" type="text" placeholder="æ€»ä½“å‡€èƒœ" readonly> 
            <input id="stat-win-rate" type="text" placeholder="æ€»ä½“èƒœç‡" readonly> 
            <input id="stat-total-profit" type="text" placeholder="æ€»ä½“ç›ˆåˆ©" readonly> 
            <input id="stat-average-win" type="text" placeholder="æ€»ä½“å¹³å‡èµ¢" readonly>
            <input id="stat-goal-complete" type="text" placeholder="å®Œæˆæ€»ä½“æœŸæœ›" readonly> 
            <input id="stat-round-hole" type="text" placeholder="æ€»ä½“ç æ´" readonly>
            <input id="round-total-hands" type="text" placeholder="å›åˆæ‰‹æ•°" readonly>
            <input id="round-win-hands" type="text" placeholder="å›åˆèƒœæ‰‹" readonly> 
            <input id="round-net-win" type="text" placeholder="å›åˆå‡€èƒœ" readonly>
            <input id="round-win-rate" type="text" placeholder="å›åˆèƒœç‡" readonly>
            <input id="round-total-profit" type="text" placeholder="å›åˆç›ˆåˆ©" readonly>
            <input id="round-average-win" type="text" placeholder="å›åˆå¹³å‡èµ¢" readonly>
            <input id="round-goal-complete" type="text" placeholder="å®Œæˆå›åˆæœŸæœ›" readonly>
            <input id="round-hole" type="text" placeholder="å›åˆç æ´" readonly>
            <input id="sys-flow-total" type="text" placeholder="æµæ°´æ€»é¢" readonly>
            <input id="sys-current-fund" type="text" placeholder="å½“å‰èµ„é‡‘" readonly>
            <input id="sys-max-loss-capital" type="text" placeholder="æœ€å¤§æ¶ˆè€—æœ¬é‡‘" readonly>
            <input id="sys-average-win" type="text" placeholder="å•æ‰‹å‡åˆ©" readonly>
            <input id="sys-max-netwin" type="text" placeholder="æœ€å¤§å‡€èƒœ" readonly>
            <input id="sys-min-netwin" type="text" placeholder="æœ€å°å‡€èƒœ" readonly>
            <input id="sys-total-forecast" type="text" placeholder="æ€»ä½“é¢„çŸ¥" readonly>
            <input id="sys-round-forecast" type="text" placeholder="å›åˆé¢„çŸ¥" readonly>
        </div>

        <div class="button-grid">
            <button id="deleteData">åˆ é™¤æ•°æ®</button>
            <button id="recordHistory">è®°å½•å†å²</button>
            <button id="toggleMode">æ¥å…¥AI</button>
            <button id="recordRewrite">è®°å½•é‡å†™</button>
            <button id="resetFlow">é‡ç½®æµæ°´</button>
            <button id="restartSystem">é‡å¯ç³»ç»Ÿ</button>
            <button id="temporaryView">ä¸´æ—¶æŸ¥çœ‹</button>
            <button id="randomDirection">éšæœºæ–¹å‘</button>
            <button id="winB">WINB</button>
            <button id="winP">WINP</button>
            <button id="losB">LOSB</button>
            <button id="losP">LOSP</button>
        </div>

        <div class="ledger-container">
            <table class="ledger">
                <tbody>
                    <tr class="frozen-row"><td colspan="5"></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- åŠ è½½æ ¸å¿ƒé€»è¾‘ -->
    <script type="module" src="./app-with-cloud.js"></script>
</body>
</html>